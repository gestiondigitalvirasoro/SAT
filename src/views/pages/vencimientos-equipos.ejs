<!DOCTYPE html>
<html lang="es">
<%- include('../partials/head', { title: 'Vencimientos de Equipos - Potencia Activa' }) %>
<body>
    <%- include('../partials/navbar-dashboard') %>
    
    <div class="page-container" style="margin-top: 100px; padding: 20px;">
        <div class="page-header">
            <h1>Vencimientos de Equipos Extintores</h1>
        </div>

        <!-- Filtros y Controles -->
        <div class="controls-section" style="margin-bottom: 30px; display: flex; gap: 20px; align-items: center; flex-wrap: wrap;">
            <div style="flex: 1; min-width: 250px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 500;">Empresa</label>
                <select id="empresa" class="form-control" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                    <option value="">-- TODOS</option>
                    <option value="LINOR SRL">LINOR SRL</option>
                    <option value="TecnoPalet">TecnoPalet</option>
                    <option value="Distribuidora Gonz√°lez">Distribuidora Gonz√°lez</option>
                    <option value="Metal√∫rgica del Sur">Metal√∫rgica del Sur</option>
                </select>
            </div>

            <div style="display: flex; gap: 10px; align-items: flex-end;">
                <button class="btn btn-sm btn-outline-secondary" onclick="previousYear()" style="padding: 8px 12px; border: 1px solid #999;">¬´</button>
                <button class="btn btn-sm btn-primary" onclick="goToToday()" style="padding: 8px 12px; background-color: #1976d2; color: white; border: none; border-radius: 4px;">Hoy</button>
                <button class="btn btn-sm btn-outline-secondary" onclick="nextYear()" style="padding: 8px 12px; border: 1px solid #999;">¬ª</button>
                <span id="yearDisplay" style="font-weight: bold; min-width: 60px; text-align: center;">2025</span>
            </div>
        </div>

        <!-- Calendario -->
        <div class="calendar-section" style="margin-bottom: 40px;">
            <p style="color: #d32f2f; margin-bottom: 15px; font-weight: 500;"><strong>* Click en el n√∫mero para ver el detalle de equipos</strong></p>
            <div class="calendar-wrapper" style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); overflow-x: auto;">
                <table class="calendar-table" style="width: 100%; border-collapse: collapse; min-width: 1000px;">
                    <thead>
                        <tr style="background-color: #f5f5f5;">
                            <th style="padding: 15px; text-align: center; font-weight: bold; border: 1px solid #ddd;">Ene</th>
                            <th style="padding: 15px; text-align: center; font-weight: bold; border: 1px solid #ddd;">Feb</th>
                            <th style="padding: 15px; text-align: center; font-weight: bold; border: 1px solid #ddd;">Mar</th>
                            <th style="padding: 15px; text-align: center; font-weight: bold; border: 1px solid #ddd;">Abr</th>
                            <th style="padding: 15px; text-align: center; font-weight: bold; border: 1px solid #ddd;">May</th>
                            <th style="padding: 15px; text-align: center; font-weight: bold; border: 1px solid #ddd;">Jun</th>
                            <th style="padding: 15px; text-align: center; font-weight: bold; border: 1px solid #ddd;">Jul</th>
                            <th style="padding: 15px; text-align: center; font-weight: bold; border: 1px solid #ddd;">Ago</th>
                            <th style="padding: 15px; text-align: center; font-weight: bold; border: 1px solid #ddd;">Sep</th>
                            <th style="padding: 15px; text-align: center; font-weight: bold; border: 1px solid #ddd;">Oct</th>
                            <th style="padding: 15px; text-align: center; font-weight: bold; border: 1px solid #ddd;">Nov</th>
                            <th style="padding: 15px; text-align: center; font-weight: bold; border: 1px solid #ddd;">Dic</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr id="dataRow">
                            <td style="padding: 20px; text-align: center; border: 1px solid #ddd;"></td>
                            <td style="padding: 20px; text-align: center; border: 1px solid #ddd;"></td>
                            <td style="padding: 20px; text-align: center; border: 1px solid #ddd;"></td>
                            <td style="padding: 20px; text-align: center; border: 1px solid #ddd;"></td>
                            <td style="padding: 20px; text-align: center; border: 1px solid #ddd;"></td>
                            <td style="padding: 20px; text-align: center; border: 1px solid #ddd;"></td>
                            <td style="padding: 20px; text-align: center; border: 1px solid #ddd;"></td>
                            <td style="padding: 20px; text-align: center; border: 1px solid #ddd;"></td>
                            <td style="padding: 20px; text-align: center; border: 1px solid #ddd;"></td>
                            <td style="padding: 20px; text-align: center; border: 1px solid #ddd;"></td>
                            <td style="padding: 20px; text-align: center; border: 1px solid #ddd;"></td>
                            <td style="padding: 20px; text-align: center; border: 1px solid #ddd;"></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Tabla de Detalles -->
        <div class="details-section" style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3 id="detailsTitle">Vencimientos de equipos: May 2025</h3>
                <div style="display: flex; gap: 10px;">
                    <button class="btn btn-sm btn-outline-primary" onclick="printTable()" style="padding: 8px 12px; border: 1px solid #1976d2; color: #1976d2; background: white; border-radius: 4px; cursor: pointer;" title="Imprimir">üñ®Ô∏è Imprimir</button>
                    <button class="btn btn-sm btn-outline-primary" onclick="downloadCSV()" style="padding: 8px 12px; border: 1px solid #1976d2; color: #1976d2; background: white; border-radius: 4px; cursor: pointer;" title="Descargar">üì• Descargar</button>
                </div>
            </div>

            <div style="overflow-x: auto;">
                <table class="details-table" style="width: 100%; border-collapse: collapse;">
                    <thead style="background-color: #f5f5f5;">
                        <tr>
                            <th style="padding: 12px; text-align: left; font-weight: bold; border: 1px solid #ddd;">Cliente</th>
                            <th style="padding: 12px; text-align: left; font-weight: bold; border: 1px solid #ddd;">Locaci√≥n</th>
                            <th style="padding: 12px; text-align: left; font-weight: bold; border: 1px solid #ddd;">Puesto</th>
                            <th style="padding: 12px; text-align: left; font-weight: bold; border: 1px solid #ddd;">Nro Equipo</th>
                            <th style="padding: 12px; text-align: left; font-weight: bold; border: 1px solid #ddd;">Ubicaci√≥n</th>
                            <th style="padding: 12px; text-align: left; font-weight: bold; border: 1px solid #ddd;">Sector</th>
                            <th style="padding: 12px; text-align: left; font-weight: bold; border: 1px solid #ddd;">Marca</th>
                            <th style="padding: 12px; text-align: left; font-weight: bold; border: 1px solid #ddd;">Tipo-Capacidad</th>
                            <th style="padding: 12px; text-align: left; font-weight: bold; border: 1px solid #ddd;">Vida Util</th>
                            <th style="padding: 12px; text-align: left; font-weight: bold; border: 1px solid #ddd;">Venc Carga</th>
                            <th style="padding: 12px; text-align: left; font-weight: bold; border: 1px solid #ddd;">Venc PH</th>
                        </tr>
                    </thead>
                    <tbody id="detailsTableBody">
                        <tr><td colspan="11" style="padding: 20px; text-align: center; color: #999;">Selecciona un mes para ver detalles</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Datos de demo con vencimientos de equipos
        const DEMO_DATA = {
            '2025-05': [
                { cliente: 'LINOR SRL', locacion: 'ASERRADERO', puesto: 2, nro_equipo: 1, ubicacion: 'Armado de pallets', sector: 'Aserradero', marca: 'GEORGIA', tipo: 'PQS ABC-10', vida_util: 2040, venc_carga: 'May-2024', venc_ph: 'May-2025' },
                { cliente: 'LINOR SRL', locacion: 'ASERRADERO', puesto: 4, nro_equipo: 1, ubicacion: 'L√≠nea 3 de aserrado', sector: 'Aserradero', marca: 'GEORGIA', tipo: 'PQS ABC-5', vida_util: 2040, venc_carga: 'May-2024', venc_ph: 'May-2025' },
                { cliente: 'TecnoPalet', locacion: 'Aserradero', puesto: 8, nro_equipo: 8, ubicacion: 'oficina', sector: 'Administracion', marca: 'ANTARTIDA', tipo: 'HCFC 123 ABC-10', vida_util: 2045, venc_carga: 'May-2025', venc_ph: 'May-2025' },
                { cliente: 'LINOR SRL', locacion: 'ASERRADERO', puesto: 1, nro_equipo: 2, ubicacion: 'Pulm√≥n previo al molino', sector: 'Aserradero', marca: 'CAROLINA', tipo: 'CO2 5kg', vida_util: 2039, venc_carga: 'May-2024', venc_ph: 'May-2025' },
            ],
            '2025-09': [
                { cliente: 'LINOR SRL', locacion: 'ASERRADERO', puesto: 3, nro_equipo: 2, ubicacion: 'Zona de clasificaci√≥n', sector: 'Aserradero', marca: 'GEORGIA', tipo: 'PQS ABC-15', vida_util: 2040, venc_carga: 'Sep-2024', venc_ph: 'Sep-2025' },
                { cliente: 'Distribuidora Gonz√°lez', locacion: 'Dep√≥sito', puesto: 5, nro_equipo: 5, ubicacion: '√Årea de embalaje', sector: 'Log√≠stica', marca: 'ANSUL', tipo: 'AFFF 6L', vida_util: 2041, venc_carga: 'Sep-2024', venc_ph: 'Sep-2025' },
                { cliente: 'TecnoPalet', locacion: 'Planta', puesto: 12, nro_equipo: 12, ubicacion: 'Sal√≥n de producci√≥n', sector: 'Producci√≥n', marca: 'BRITANNIA', tipo: 'PQS ABC-10', vida_util: 2040, venc_carga: 'Sep-2024', venc_ph: 'Sep-2025' },
                { cliente: 'Metal√∫rgica del Sur', locacion: 'Nave central', puesto: 7, nro_equipo: 7, ubicacion: 'Taller mec√°nico', sector: 'Producci√≥n', marca: 'GEORGIA', tipo: 'PQS ABC-20', vida_util: 2042, venc_carga: 'Sep-2024', venc_ph: 'Sep-2025' },
            ],
            '2025-10': [
                { cliente: 'LINOR SRL', locacion: 'ASERRADERO', puesto: 6, nro_equipo: 6, ubicacion: 'Secadero industrial', sector: 'Aserradero', marca: 'CAROLINA', tipo: 'CO2 15kg', vida_util: 2040, venc_carga: 'Oct-2024', venc_ph: 'Oct-2025' },
                { cliente: 'Distribuidora Gonz√°lez', locacion: 'Oficina central', puesto: 9, nro_equipo: 9, ubicacion: 'Gerencia', sector: 'Administraci√≥n', marca: 'GEORGIA', tipo: 'PQS ABC-3', vida_util: 2042, venc_carga: 'Oct-2024', venc_ph: 'Oct-2025' },
                { cliente: 'TecnoPalet', locacion: 'Almac√©n', puesto: 11, nro_equipo: 11, ubicacion: 'Entrada principal', sector: 'Log√≠stica', marca: 'ANSUL', tipo: 'AFFF 3L', vida_util: 2041, venc_carga: 'Oct-2024', venc_ph: 'Oct-2025' },
            ],
            '2025-11': [
                { cliente: 'LINOR SRL', locacion: 'ASERRADERO', puesto: 7, nro_equipo: 7, ubicacion: 'Sala de m√°quinas', sector: 'Aserradero', marca: 'GEORGIA', tipo: 'PQS ABC-5', vida_util: 2040, venc_carga: 'Nov-2024', venc_ph: 'Nov-2025' },
                { cliente: 'Metal√∫rgica del Sur', locacion: 'Oficina', puesto: 10, nro_equipo: 10, ubicacion: 'Despacho de ventas', sector: 'Administraci√≥n', marca: 'BRITANNIA', tipo: 'PQS ABC-6', vida_util: 2041, venc_carga: 'Nov-2024', venc_ph: 'Nov-2025' },
                { cliente: 'TecnoPalet', locacion: 'Planta', puesto: 13, nro_equipo: 13, ubicacion: '√Årea de corte', sector: 'Producci√≥n', marca: 'GEORGIA', tipo: 'PQS ABC-10', vida_util: 2040, venc_carga: 'Nov-2024', venc_ph: 'Nov-2025' },
            ],
            '2025-12': [
                { cliente: 'LINOR SRL', locacion: 'ASERRADERO', puesto: 8, nro_equipo: 8, ubicacion: 'Comedor', sector: 'Aserradero', marca: 'CAROLINA', tipo: 'PQS ABC-4', vida_util: 2040, venc_carga: 'Dic-2024', venc_ph: 'Dic-2025' },
                { cliente: 'Distribuidora Gonz√°lez', locacion: 'Dep√≥sito', puesto: 14, nro_equipo: 14, ubicacion: '√Årea frigor√≠fica', sector: 'Log√≠stica', marca: 'ANSUL', tipo: 'AFFF 5L', vida_util: 2041, venc_carga: 'Dic-2024', venc_ph: 'Dic-2025' },
                { cliente: 'Metal√∫rgica del Sur', locacion: 'Nave central', puesto: 15, nro_equipo: 15, ubicacion: 'Soldadura', sector: 'Producci√≥n', marca: 'GEORGIA', tipo: 'PQS ABC-12', vida_util: 2040, venc_carga: 'Dic-2024', venc_ph: 'Dic-2025' },
                { cliente: 'TecnoPalet', locacion: 'Planta', puesto: 16, nro_equipo: 16, ubicacion: 'Vestiario', sector: 'Administraci√≥n', marca: 'BRITANNIA', tipo: 'PQS ABC-2', vida_util: 2041, venc_carga: 'Dic-2024', venc_ph: 'Dic-2025' },
            ],
        };

        let currentDate = new Date();

        function updateCalendar() {
            const year = currentDate.getFullYear();
            const row = document.getElementById('dataRow');
            row.innerHTML = '';

            for (let month = 0; month < 12; month++) {
                const monthKey = `${year}-${String(month + 1).padStart(2, '0')}`;
                const count = DEMO_DATA[monthKey] ? DEMO_DATA[monthKey].length : 0;
                const td = document.createElement('td');
                
                if (count > 0) {
                    td.innerHTML = `<span style="display: inline-block; padding: 10px 15px; background-color: #FFC107; border-radius: 4px; cursor: pointer; font-weight: bold; color: #000;" onclick="viewMonth('${monthKey}')">${count}</span>`;
                } else {
                    td.innerHTML = '<span style="color: #ccc;">-</span>';
                }
                
                td.style.padding = '20px';
                td.style.textAlign = 'center';
                td.style.border = '1px solid #ddd';
                row.appendChild(td);
            }

            document.getElementById('yearDisplay').textContent = year;
        }

        function previousYear() {
            currentDate.setFullYear(currentDate.getFullYear() - 1);
            updateCalendar();
        }

        function nextYear() {
            currentDate.setFullYear(currentDate.getFullYear() + 1);
            updateCalendar();
        }

        function goToToday() {
            currentDate = new Date();
            updateCalendar();
        }

        function viewMonth(monthKey) {
            const [year, month] = monthKey.split('-');
            const monthNames = ['', 'Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'];
            const monthName = monthNames[parseInt(month)];
            
            document.getElementById('detailsTitle').textContent = `Vencimientos de equipos: ${monthName} ${year}`;
            
            // Obtener datos del mes
            let datos = DEMO_DATA[monthKey] || [];
            
            // Filtrar por empresa si est√° seleccionada
            const empresaSeleccionada = document.getElementById('empresa').value;
            if (empresaSeleccionada) {
                datos = datos.filter(item => item.cliente === empresaSeleccionada);
            }
            
            const tbody = document.getElementById('detailsTableBody');
            tbody.innerHTML = '';

            if (datos.length === 0) {
                tbody.innerHTML = '<tr><td colspan="11" style="padding: 20px; text-align: center; color: #999;">No hay datos para este mes</td></tr>';
                return;
            }

            datos.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td style="padding: 10px; border: 1px solid #ddd;">${item.cliente}</td>
                    <td style="padding: 10px; border: 1px solid #ddd;">${item.locacion}</td>
                    <td style="padding: 10px; border: 1px solid #ddd;">${item.puesto}</td>
                    <td style="padding: 10px; border: 1px solid #ddd;">${item.nro_equipo}</td>
                    <td style="padding: 10px; border: 1px solid #ddd;">${item.ubicacion}</td>
                    <td style="padding: 10px; border: 1px solid #ddd;">${item.sector}</td>
                    <td style="padding: 10px; border: 1px solid #ddd;">${item.marca}</td>
                    <td style="padding: 10px; border: 1px solid #ddd;">${item.tipo}</td>
                    <td style="padding: 10px; border: 1px solid #ddd;">${item.vida_util}</td>
                    <td style="padding: 10px; border: 1px solid #ddd;">${item.venc_carga}</td>
                    <td style="padding: 10px; border: 1px solid #ddd;">${item.venc_ph}</td>
                `;
                tbody.appendChild(row);
            });
        }

        function printTable() {
            window.print();
        }

        function downloadCSV() {
            alert('Funci√≥n de descarga en desarrollo');
        }

        // Inicializar cuando carga la p√°gina
        document.addEventListener('DOMContentLoaded', () => {
            updateCalendar();
            viewMonth('2025-05'); // Mostrar mayo por defecto
            
            // Agregar event listener al filtro de empresa
            document.getElementById('empresa').addEventListener('change', () => {
                // Obtener el mes actual que se est√° mostrando del t√≠tulo
                const title = document.getElementById('detailsTitle').textContent;
                const monthMatch = title.match(/(\w+)\s(\d{4})/);
                if (monthMatch) {
                    const monthNames = {'Enero': '01', 'Febrero': '02', 'Marzo': '03', 'Abril': '04', 'Mayo': '05', 'Junio': '06', 'Julio': '07', 'Agosto': '08', 'Septiembre': '09', 'Octubre': '10', 'Noviembre': '11', 'Diciembre': '12'};
                    const monthNumber = monthNames[monthMatch[1]];
                    const year = monthMatch[2];
                    const monthKey = `${year}-${monthNumber}`;
                    viewMonth(monthKey);
                }
            });
        });
    </script>
</body>
</html>
